<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Xanalytics · Live Analytics</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="window">
    <div class="titlebar">
      <span class="badge">XANALYTICS</span>
      <span>Live Analytics</span>
      <div class="styleSwitch small">
        Style:
        <select id="styleSel" class="input">
          <option value="classic">Classic (Windows XP)</option>
          <option value="dark" selected>Dark (Oracle)</option>
        </select>
      </div>
    </div>

    <div class="content">
      <div class="grid">

        <!-- LEFT SIDE -->
        <section>
          <div class="group">
            <h3>Source</h3>

            <div class="drop" id="drop" tabindex="0">
              <div>
                <div style="font-weight:800">Drop log file here</div>
                <div class="small">or click <kbd>Attach</kbd> (Chrome/Edge best)</div>
              </div>
            </div>

            <div id="fileInfo" class="small" style="display:none;margin-top:6px"></div>

            <div class="toolbar" style="margin-top:6px">
              <button class="btn" id="btnAttach">Attach</button>
              <button class="btn ghost" id="btnInfo">Info / Help</button>
              <button class="btn ghost" id="btnReset">Reset</button>
            </div>

            <!-- info window -->
            <div id="infoPanel" class="infoPanel" style="display:none; margin-top:10px;">
              <div class="infoTabs">
                <button class="infoTabBtn active" data-tab="tab-howto">How to Use</button>
                <button class="infoTabBtn" data-tab="tab-notes">Notes & Tips</button>
                <button class="infoCloseBtn" id="infoCloseBtn">✕</button>
              </div>
              <div class="infoBody">
                <div class="infoTabContent" id="tab-howto" style="display:block;">
                  <div class="small">
                    <p><b>Step 1.</b> Drag your Anarchy Online log file into the drop zone above, or press Attach.</p>
                    <p><b>Step 2.</b> The tool will tail from the end of the file. New kills, loot, XP, etc. will populate live.</p>
                    <p><b>Step 3.</b> Watch:
                      <ul>
                        <li><b>Metrics Table</b>: drop %, kept vs deleted, source, last-seen time.</li>
                        <li><b>XP Metrics</b>: XP / AXP / SK / Research gain rates and ETAs.</li>
                        <li><b>XP feed</b>: rolling log of the last ~40 XP hits.</li>
                      </ul>
                    </p>
                    <p><b>Reset</b> clears session stats, uptime, and XP totals, and stops tailing. You can then attach another file.</p>
                  </div>
                </div>

                <div class="infoTabContent" id="tab-notes" style="display:none;">
                  <div class="small">
                    <p><b>Filters:</b> You can include/exclude discarded lines from % math, normalize % to only what’s visible, dim items that were never kept, sort, and search by name or source. That affects both the table and the “Visible % sum”.</p>
                    <p><b>XP Goals:</b> Put in how much XP / AXP / SK you still need. The bars and ETA update live using a 10-minute rolling rate sample.</p>
                    <p><b>Rotation-aware:</b> If the log file rolls or shrinks, the parser treats that as a new file and keeps going. That’s “rot=…” in the status bar.</p>
                    <p><b>Privacy:</b> Everything is local. Export State / Export CSV just download files to your machine.</p>
                    <p><b>Style:</b> “Dark (Oracle)” is the modern HUD. “Classic (Windows XP)” switches to the old-school UI.</p>
                  </div>
                </div>
              </div>
            </div>
            <!-- /infoPanel -->
          </div>

          <div class="group">
            <h3>Settings</h3>
            <div class="row">
              <label class="checkbox-row"><input id="inclDiscarded" type="checkbox" checked/> Include Discarded in %</label>
              <label class="checkbox-row"><input id="normalizeVisible" type="checkbox"/> Normalize % to visible</label>
              <label class="checkbox-row"><input id="dimDiscardedOnly" type="checkbox" checked/> Dim discarded-only rows</label>
            </div>

            <hr class="divider">

            <div class="row">
              <label>Sort</label>
              <select id="eventSortBy" class="input">
                <option value="events">Events</option>
                <option value="percent">Percent</option>
                <option value="kept">Kept</option>
                <option value="discarded">Discarded</option>
                <option value="name">Name</option>
                <option value="last">Last Seen</option>
              </select>
              <select id="eventSortDir" class="input">
                <option value="desc">Desc</option>
                <option value="asc">Asc</option>
              </select>

              <input id="eventSearch" class="input w" placeholder="Search event or source…"/>

              <span class="segment">
                <button id="viewAll" class="active">All</button>
                <button id="viewKept">Kept</button>
                <button id="viewDiscarded">Discarded</button>
              </span>
            </div>
          </div>

          <div class="group">
            <h3>Session</h3>
            <div class="small">Cutoff: <span id="cutoffLabel">—</span></div>
            <div class="small">Mode: <span id="modeLabel">Awaiting file</span></div>
            <div class="small">Path: <span id="pathLabel" class="path">—</span></div>
          </div>

          <div class="group">
            <h3>XP Filters</h3>
            <div class="row">
              <label class="checkbox-row"><input id="fxp"  type="checkbox" checked/> <span class="pill xp">XP</span></label>
              <label class="checkbox-row"><input id="faxp" type="checkbox" checked/> <span class="pill axp">AXP</span></label>
              <label class="checkbox-row"><input id="fsk"  type="checkbox" checked/> <span class="pill sk">SK</span></label>
              <label class="checkbox-row"><input id="frxp" type="checkbox" checked/> <span class="pill rxp">Research</span></label>
            </div>
            <div class="small">Filters affect totals, rates, ETAs, and XP feed visibility.</div>
          </div>
        </section>

        <!-- RIGHT SIDE -->
        <section>
          <div class="group">
            <h3>Metrics Table</h3>
            <div class="table" id="table"><pre>(waiting for file…)</pre></div>
            <div class="sumline" id="sumLine">Visible % sum: —</div>
          </div>

          <div class="group">
            <h3>XP Metrics</h3>

            <div class="kpis">
              <div class="chip"><span class="pill xp">XP</span>
                <div><div><span id="xpTotal" class="kpiVal">0</span></div>
                <div class="kpiSub"><span id="xpRate10">0/hr</span> · <span id="xpRateSess">0/hr</span> · last <span id="xpLast">0</span></div></div>
              </div>

              <div class="chip"><span class="pill axp">AXP</span>
                <div><div><span id="axpTotal" class="kpiVal">0</span></div>
                <div class="kpiSub"><span id="axpRate10">0/hr</span> · <span id="axpRateSess">0/hr</span> · last <span id="axpLast">0</span></div></div>
              </div>

              <div class="chip"><span class="pill sk">SK</span>
                <div><div><span id="skTotal" class="kpiVal">0</span></div>
                <div class="kpiSub"><span id="skRate10">0/hr</span> · <span id="skRateSess">0/hr</span> · last <span id="skLast">0</span></div></div>
              </div>

              <div class="chip"><span class="pill rxp">Research</span>
                <div><div><span id="rxpTotal" class="kpiVal">0</span></div>
                <div class="kpiSub"><span id="rxpRate10">0/hr</span> · <span id="rxpRateSess">0/hr</span> · last <span id="rxpLast">0</span></div></div>
              </div>
            </div>

            <div class="cards" style="margin-top:8px">
              <div class="card">
                <h4>XP goal</h4>
                <div class="meter"><div class="bar xp" id="barXP"></div></div>
                <div class="metaRow"><span id="xpNeedLabel" class="small">—</span><span id="xpETA" class="small">ETA —</span></div>
                <div class="row" style="margin-bottom:0; margin-top: 6px;"><input id="xpNeed" class="input w" type="number" placeholder="Enter XP needed…"/></div>
              </div>

              <div class="card">
                <h4>AXP goal</h4>
                <div class="meter"><div class="bar axp" id="barAXP"></div></div>
                <div class="metaRow"><span id="axpNeedLabel" class="small">—</span><span id="axpETA" class="small">ETA —</span></div>
                <div class="row" style="margin-bottom:0; margin-top: 6px;"><input id="axpNeed" class="input w" type="number" placeholder="Enter AXP needed…"/></div>
              </div>

              <div class="card">
                <h4>SK goal</h4>
                <div class="meter"><div class="bar sk" id="barSK"></div></div>
                <div class="metaRow"><span id="skNeedLabel" class="small">—</span><span id="skETA" class="small">ETA —</span></div>
                <div class="row" style="margin-bottom:0; margin-top: 6px;"><input id="skNeed" class="input w" type="number" placeholder="Enter SK needed…"/></div>
              </div>
            </div>

            <div class="metaRow" style="margin-top:6px">
              <span class="small" id="xpUptime">Uptime — 0m</span>
              <span class="small" id="xpEvents">XP events — 0</span>
            </div>

            <div class="feed" id="xpFeed" style="margin-top:6px"><div class="small dim">(XP feed populates as you tail)</div></div>
          </div>

          <div class="panes">
            <div class="group">
              <h3>Parsed Log <button class="btn ghost" id="toggleParsed" style="font-size:11px; padding: 2px 6px;">Show</button></h3>
              <div class="pane" id="parsedLog" style="display:none"></div>
            </div>
            <div class="group">
              <h3>Debug Trace <button class="btn ghost" id="toggleDebug" style="font-size:11px; padding: 2px 6px;">Show</button></h3>
              <div class="pane mono" id="debugPane" style="display:none"><pre>(hidden)</pre></div>
            </div>
          </div>

          <div class="group">
            <h3>Raw Log (recent) <button class="btn ghost" id="toggleRaw" style="font-size:11px; padding: 2px 6px;">Show</button></h3>
            <div class="pane mono" id="rawPane" style="display:none"><pre>(hidden)</pre></div>
          </div>
        </section>
      </div>

      <div class="statusbar">
        <div class="small">Xanalytics — local only</div>

        <div class="small" style="display:flex;align-items:center;gap:8px">
          <span class="dot" id="dot"></span><span id="statusText">Idle</span>
          <span id="metricsInline" class="small mono">lines=0 hits=0 misses=0 rot=0 err=0</span>
        </div>

        <div class="small">
          <a href="#" id="exportStateLink">Export state</a> ·
          <a href="#" id="exportCSVLink">Export CSV</a>
        </div>
      </div>
    </div>
  </div>

<script src="script.js"></script>
</body>
</html>
